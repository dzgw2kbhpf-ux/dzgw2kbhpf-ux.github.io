<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JDM Custom Garage</title>
<style>
body{margin:0;overflow:hidden;background:#666;}
#ui{
 position:fixed;
 bottom:10px;
 left:50%;
 transform:translateX(-50%);
 background:rgba(0,0,0,0.85);
 color:white;
 padding:10px;
 border-radius:12px;
 width:240px;
 font-size:14px;
}
#ui select,#ui input{width:100%;}
</style>
</head>
<body>

<div id="ui">
 車種
 <select id="carType">
  <option value="ae86">AE86</option>
  <option value="r34">R34</option>
  <option value="rx7">RX-7</option>
 </select>

 車高
 <input type="range" id="ride" min="0.15" max="0.35" step="0.01" value="0.22">

 ホイールサイズ
 <input type="range" id="wheelSize" min="0.9" max="1.2" step="0.01" value="1">

 ボディカラー
 <input type="color" id="bodyColor" value="#b00000">
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>
<script>
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x777777);

const camera=new THREE.PerspectiveCamera(65,innerWidth/innerHeight,0.1,100);
camera.position.set(0,1.2,4);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
renderer.physicallyCorrectLights=true;
document.body.appendChild(renderer.domElement);

/* ライト */
scene.add(new THREE.AmbientLight(0xffffff,0.9));
const sun=new THREE.DirectionalLight(0xffffff,2);
sun.position.set(5,8,6);
scene.add(sun);

/* マテリアル */
const bodyMat=new THREE.MeshStandardMaterial({
 color:0xb00000, metalness:0.75, roughness:0.25
});
const glassMat=new THREE.MeshStandardMaterial({
 color:0x111111, transparent:true, opacity:0.4
});
const tireMat=new THREE.MeshStandardMaterial({
 color:0x111111, roughness:0.9
});
const rimMat=new THREE.MeshStandardMaterial({
 color:0xaaaaaa, metalness:0.8, roughness:0.3
});

/* 車 */
let car=new THREE.Group();
scene.add(car);
let wheels=[];
let baseWheelRadius=0.32;

function buildCar(type){
 car.clear();
 wheels=[];

 let cfg={
  ae86:{len:3.2,nose:0.9,cabinZ:-0.2,height:0.45},
  r34:{len:3.6,nose:1.1,cabinZ:-0.3,height:0.5},
  rx7:{len:3.4,nose:1.0,cabinZ:-0.25,height:0.48}
 }[type];

 const lower=new THREE.Mesh(
  new THREE.BoxGeometry(1.8,cfg.height,cfg.len), bodyMat
 );
 lower.position.y=0.25;
 car.add(lower);

 const nose=new THREE.Mesh(
  new THREE.BoxGeometry(1.6,0.25,cfg.nose), bodyMat
 );
 nose.position.set(0,0.32,cfg.len/2+cfg.nose/2-0.2);
 car.add(nose);

 const cabin=new THREE.Mesh(
  new THREE.BoxGeometry(1.2,0.45,1.4), bodyMat
 );
 cabin.position.set(0,0.65,cfg.cabinZ);
 car.add(cabin);

 const glass=new THREE.Mesh(
  new THREE.BoxGeometry(1.15,0.4,1.35), glassMat
 );
 glass.position.set(0,0.7,cfg.cabinZ);
 car.add(glass);

 const wheelZ=cfg.len/2-0.6;
 [[-0.95,wheelZ],[0.95,wheelZ],[-0.95,-wheelZ],[0.95,-wheelZ]]
 .forEach(p=>{
  const tire=new THREE.Mesh(
   new THREE.CylinderGeometry(baseWheelRadius,baseWheelRadius,0.28,36),
   tireMat
  );
  tire.rotation.z=Math.PI/2;

  const rim=new THREE.Mesh(
   new THREE.CylinderGeometry(baseWheelRadius*0.6,baseWheelRadius*0.6,0.3,24),
   rimMat
  );
  rim.rotation.z=Math.PI/2;

  const w=new THREE.Group();
  w.add(tire); w.add(rim);
  w.position.set(p[0],0.15,p[1]);
  wheels.push(w);
  car.add(w);
 });
}

buildCar("ae86");

/* UI */
carType.onchange=e=>buildCar(e.target.value);
ride.oninput=e=>car.position.y=parseFloat(e.target.value);
wheelSize.oninput=e=>{
 const s=parseFloat(e.target.value);
 wheels.forEach(w=>{
  w.children[0].geometry.dispose();
  w.children[0].geometry=
   new THREE.CylinderGeometry(baseWheelRadius*s,baseWheelRadius*s,0.28,36);
 });
};
bodyColor.oninput=e=>bodyMat.color.set(e.target.value);

/* タッチ回転 */
let sx=0;
addEventListener("touchstart",e=>sx=e.touches[0].clientX);
addEventListener("touchmove",e=>{
 car.rotation.y+=(e.touches[0].clientX-sx)*0.005;
 sx=e.touches[0].clientX;
});

/* 描画 */
(function animate(){
 requestAnimationFrame(animate);
 renderer.render(scene,camera);
})();
</script>
</body>
</html>
