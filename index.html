<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JDM Procedural Car</title>
<style>
body{margin:0;overflow:hidden;background:#555;}
#ui{
 position:fixed;
 bottom:10px;
 left:50%;
 transform:translateX(-50%);
 background:rgba(0,0,0,0.85);
 color:white;
 padding:10px;
 border-radius:12px;
 width:220px;
 font-size:14px;
}
#ui input{width:100%;}
</style>
</head>
<body>

<div id="ui">
 車高
 <input id="ride" type="range" min="0.15" max="0.35" step="0.01" value="0.22">
 ホイールサイズ
 <input id="wheelSize" type="range" min="0.26" max="0.38" step="0.01" value="0.32">
 ボディカラー
 <input id="bodyColor" type="color" value="#b00000">
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>
<script>
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x777777);

const camera=new THREE.PerspectiveCamera(65,innerWidth/innerHeight,0.1,100);
camera.position.set(0,1.1,4);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
renderer.physicallyCorrectLights=true;
document.body.appendChild(renderer.domElement);

/* ライト */
scene.add(new THREE.AmbientLight(0xffffff,0.9));
const sun=new THREE.DirectionalLight(0xffffff,2);
sun.position.set(5,8,6);
scene.add(sun);

/* 車 */
const car=new THREE.Group();
scene.add(car);

/* マテリアル */
const bodyMat=new THREE.MeshStandardMaterial({
 color:0xb00000,
 metalness:0.75,
 roughness:0.25
});
const glassMat=new THREE.MeshStandardMaterial({
 color:0x111111,
 transparent:true,
 opacity:0.4
});
const lightMat=new THREE.MeshStandardMaterial({
 color:0xffffee,
 emissive:0xffffcc,
 emissiveIntensity:1
});
const tailMat=new THREE.MeshStandardMaterial({
 color:0xff0000,
 emissive:0xff0000,
 emissiveIntensity:0.8
});

/* ===== ボディ構成 ===== */
// 下部ボディ
const lower=new THREE.Mesh(
 new THREE.BoxGeometry(1.8,0.35,3.4),
 bodyMat
);
lower.position.y=0.25;
car.add(lower);

// ノーズ
const nose=new THREE.Mesh(
 new THREE.BoxGeometry(1.6,0.25,0.9),
 bodyMat
);
nose.position.set(0,0.32,1.9);
car.add(nose);

// キャビン
const cabin=new THREE.Mesh(
 new THREE.BoxGeometry(1.2,0.45,1.4),
 bodyMat
);
cabin.position.set(0,0.65,-0.2);
car.add(cabin);

// ガラス
const glass=new THREE.Mesh(
 new THREE.BoxGeometry(1.15,0.4,1.35),
 glassMat
);
glass.position.set(0,0.7,-0.2);
car.add(glass);

// フェンダー
[-1,1].forEach(x=>{
 const f=new THREE.Mesh(
  new THREE.BoxGeometry(0.25,0.35,2.6),
  bodyMat
 );
 f.position.set(x,0.25,0);
 car.add(f);
});

// ヘッドライト
[-0.5,0.5].forEach(x=>{
 const h=new THREE.Mesh(
  new THREE.BoxGeometry(0.3,0.15,0.05),
  lightMat
 );
 h.position.set(x,0.3,2.25);
 car.add(h);
});

// テールライト
[-0.5,0.5].forEach(x=>{
 const t=new THREE.Mesh(
  new THREE.BoxGeometry(0.35,0.15,0.05),
  tailMat
 );
 t.position.set(x,0.3,-2.25);
 car.add(t);
});

/* ===== タイヤ ===== */
let wheels=[];
const wheelGeo=new THREE.CylinderGeometry(0.32,0.32,0.28,32);
const wheelMat=new THREE.MeshStandardMaterial({color:0x111111});

[
 [-0.95,0, 1.3],[0.95,0, 1.3],
 [-0.95,0,-1.3],[0.95,0,-1.3]
].forEach(p=>{
 const w=new THREE.Mesh(wheelGeo,wheelMat);
 w.rotation.z=Math.PI/2;
 w.position.set(p[0],0.15,p[2]);
 wheels.push(w);
 car.add(w);
});

/* ===== UI ===== */
ride.oninput=e=>{
 const y=parseFloat(e.target.value);
 lower.position.y=y;
 nose.position.y=y+0.07;
 cabin.position.y=y+0.4;
 glass.position.y=y+0.45;
 wheels.forEach(w=>w.position.y=y-0.1);
};

wheelSize.oninput=e=>{
 wheels.forEach(w=>w.scale.set(e.target.value,e.target.value,1));
};

bodyColor.oninput=e=>{
 bodyMat.color.set(e.target.value);
};

/* タッチ回転 */
let sx=0;
addEventListener("touchstart",e=>sx=e.touches[0].clientX);
addEventListener("touchmove",e=>{
 let dx=e.touches[0].clientX-sx;
 car.rotation.y+=dx*0.005;
 sx=e.touches[0].clientX;
});

/* 描画 */
function animate(){
 requestAnimationFrame(animate);
 renderer.render(scene,camera);
}
animate();

onresize=()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
};
</script>
</body>
</html>
